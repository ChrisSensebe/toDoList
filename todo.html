<!DOCTYPE html>
<html>
	<head>
		<title>todolist en temps réel</title>
	</head>

	<body>
		<h1>Todolist en temps réel</h1>

		<ul id="todo">
		</ul>

		<form id="todoForm">
			<label for="tache">nouvelle tache</label>
			<input type="text" name="tache" id="tache" autofocus>
			<input type="submit" value="ajouter">
		</form>

		<script type="text/javascript" src="http://code.jquery.com/jquery-1.11.2.min.js"></script>
		<script type="text/javascript" src="/socket.io/socket.io.js"></script>
		<script type="text/javascript">

			//connection a socket.io
			var socket = io.connect("http://localhost:8080");

			function lastId(){
				if($("button").length == 0){
					id = 0;
				}
				else{
					id = $("button").length;
				}
				return id;
			}

			//recupération de la todolist rafraichissement de la liste
			socket.on("todo", function(todo){
				$("#todo").empty();
				for(var i=0; i<todo.length; i++){
					$("#todo").append("<li><button type=\"button\" id=" + i + ">✘</button>" + todo[i] + "</li>");
				}
			});

			//ajout tache
			$("#todoForm").submit(function(){
				var tache = $("#tache").val();
				socket.emit("newTask", tache);
				$("#todo").append("<li><button type=\"button\" id=" + lastId() + ">✘</button>" + tache + "</li>");
				$("#tache").val("").focus();
				lastId();
				return false;
			});

			//supression tache
			/*

				reste a rafraichir id elements liste !!!!!

			*/
			$("#todo").on("click", "button", function(){
				var index = $(this).attr("id");
				socket.emit("deleteTask", index);
				$(this).closest("li").remove();
			});

		</script>
	</body>
</html>