<!DOCTYPE html>
<html>
	<head>
		<title>todolist en temps réel</title>
	</head>

	<body>
		<h1>todolist en temps réel</h1>

		<ul id="todo">
		</ul>

		<form action="/" method="post" id="todoForm">
			<label for="tache">Que dois-je faire?</label>
			<input type="text" name="tache" id="tache" autofocus>
			<input type="submit" id="envoiTache" value="envoyer">
		</form>

		<script type="text/javascript" src="http://code.jquery.com/jquery-1.11.2.min.js"></script>
		<script type="text/javascript" src="/socket.io/socket.io.js"></script>
		<script type="text/javascript">

			//connection a socket.io
			var socket = io.connect("http://localhost:8080");

			//recupération de la todolist et modification de la page
			socket.on("todo", function(todo){
				for(var i=0; i<todo.length; i++){
					$("#todo").append("<li><a href=\"#\" id=\"i\" class=\"task\">✘</a>" + todo[i] +"</li>");
				}
			});

			//ajout tache
			$("#todoForm").submit(function(){
				var tache = $("#tache").val(); //recupere la tache
				socket.emit("tache", tache);   //emet la tache
				$("#tache").val("").focus();   //vide la zone de saisie et la remet en focus
				return false;                  //bloque l'envoi classique du formulaire
			});

			//supression tache
			$(".task").click(function(){
				var index = $(".task").attr("id"); //recupere l'index de la tache
				socket.emit("deleteTask", index);  //emet l'index de la tache a suprrimer
			});

		</script>
	</body>
</html>