<!DOCTYPE html>
<html>
	<head>
		<title>todolist en temps réel</title>
	</head>

	<body>
		<h1>Todolist en temps réel</h1>

		<ul id="todo">
		</ul>

		<form id="todoForm">
			<label for="tache">nouvelle tache</label>
			<input type="text"id="tache" autofocus>
			<input type="submit">
		</form>

		<script type="text/javascript" src="http://code.jquery.com/jquery-1.11.2.min.js"></script>
		<script type="text/javascript" src="/socket.io/socket.io.js"></script>
		<script type="text/javascript">

			//connection a socket.io
			var socket = io.connect("http://localhost:8080");

			//à la reception de la lsite, rafraichissement de la liste affichée
			socket.on("todo", function(todo){
				$("#todo").empty();
				for(var i=0; i<todo.length; i++){
					$("#todo").append("<li><button>✘</button>" + todo[i] + "</li>");
				}
			});

			//recupération de la tache à ajouter, emission de celle-ci, rajout à la liste affichée
			$("#todoForm").submit(function(){
				var tache = $("#tache").val();
				socket.emit("newTask", tache);
				$("#todo").append("<li><button>✘</button>" + tache + "</li>");
				$("#tache").val("").focus();
				return false;
			});

			//recupération de la tache à supprimer, émission de celle-ci, supression de la liste affichée
			$("#todo").on("click", "button", function(){
				$(this).text("");
				var task = $(this).closest("li").text();
				socket.emit("deleteTask", task);
				$(this).closest("li").remove();
			});

		</script>
	</body>
</html>